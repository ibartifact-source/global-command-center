<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: transparent; color: white; }
        .msg-content { transition: all 0.3s ease; }
        .sync-flash { animation: flash 0.5s ease-out; }
        @keyframes flash {
            0% { background: rgba(234, 179, 8, 0.5); }
            100% { background: transparent; }
        }
    </style>
</head>
<body class="p-4">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-xs font-black text-yellow-500 tracking-tighter uppercase">Incoming Stream (From Engineer)</h2>
        <button onclick="window.forceTranslateSync()" 
                class="bg-yellow-500 hover:bg-yellow-400 text-black text-[10px] font-black px-3 py-1 rounded shadow-lg flex items-center gap-1 active:scale-95 transition-all">
            <span>ğŸ”„</span> SYNC & TRANSLATE
        </button>
    </div>

    <div id="message-display" class="bg-black/40 border border-white/10 rounded-lg p-4 min-h-[200px] msg-content">
        <p class="text-sm leading-relaxed" id="text-target">
            Waiting for incoming message from engineer...
        </p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyDCOnj1LQU3BqCrbec9VP9Wg1v-AJrrpMw",
          authDomain: "global-command-center-6235f.firebaseapp.com",
          projectId: "global-command-center-6235f",
          storageBucket: "global-command-center-6235f.firebasestorage.app",
          messagingSenderId: "241628307606",
          appId: "1:241628307606:web:7d5e3f60394671632062b7",
          measurementId: "G-F4S7S0XH5Q"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // å®šç¾©åŒæ­¥å‡½å¼åˆ°å…¨åŸŸ
        window.forceTranslateSync = () => {
            const target = document.getElementById('text-target');
            const originalText = target.innerText;
            target.innerText = ""; // ç‰©ç†æ¸…ç©º
            setTimeout(() => {
                target.innerText = originalText;
                const container = document.getElementById('message-display');
                container.classList.add('sync-flash');
                setTimeout(() => container.classList.remove('sync-flash'), 500);
            }, 50);
        };

        // å¯¦æ™‚ç›£è½ï¼šæ¥æ”¶å·¥ç¨‹å¸«ç™¼çµ¦å°æ¼”çš„è¨Šè™Ÿ (e_to_d)
        onSnapshot(doc(db, "signals", "e_to_d"), (snap) => {
            if (snap.exists()) {
                const data = snap.data();
                document.getElementById('text-target').innerText = data.msg;
                window.forceTranslateSync(); // æ¥æ”¶åˆ°æ–°è¨Šæ¯æ™‚è‡ªå‹•èª˜ç™¼ç¿»è­¯åµæ¸¬
            }
        });
    </script>
</body>
</html>
